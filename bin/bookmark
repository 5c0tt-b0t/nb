#!/usr/bin/env bash
###############################################################################
#     __                __                        __
#    / /_  ____  ____  / /______ ___  ____ ______/ /__
#   / __ \/ __ \/ __ \/ //_/ __ `__ \/ __ `/ ___/ //_/
#  / /_/ / /_/ / /_/ / ,< / / / / / / /_/ / /  / ,<
# /_.___/\____/\____/_/|_/_/ /_/ /_/\__,_/_/  /_/|_|
#
# bookmark -- Command line bookmarking.
#
# Part of:
# __                _
# \ \   _ __   ___ | |_ ___  ___
#  \ \ | '_ \ / _ \| __/ _ \/ __|
#  / / | | | | (_) | ||  __/\__ \
# /_/  |_| |_|\___/ \__\___||___/
#
# `notes`
#
# Command line note-taking, bookmarking, and archiving with encryption, search,
# Git-backed versioning and syncing, Pandoc-backed format conversion, and more
# in a single portable script.
#
# https://github.com/xwmx/notes
#
# Based on Bash Boilerplate: https://github.com/xwmx/bash-boilerplate
#
# Copyright (c) 2015-present William Melody â€¢ hi@williammelody.com
# GPLv2 â€¢ See LICENSE for details.
###############################################################################

export _NOTES_PATH="${_NOTES_PATH:-}"

if [[ -z "${_NOTES_PATH:-}" ]]
then
  _NOTES_PATH="$(command -v notes)"
fi

if [[ -z "${_NOTES_PATH:-}" ]]
then
  cat <<HEREDOC
\`bookmark\` is part of \`notes\`. To install \`notes\`, see:
  https://github.com/xwmx/notes
HEREDOC
fi

_main() {
  if [[ -z "${1:-}" ]]
  then
    local _count=0
    while IFS= read -r __line
    do
      _count=$((_count+1))

      if [[ "${_count}" == 1 ]] ||
         [[ "${_count}" == 6 ]] ||
         [[ "${_count}" == 8 ]]
      then
        printf "%s\\n" "${__line}" \
          | sed -e 's/notes bookmark/bookmark/' \
          | sed -e 's/notes help bookmark/bookmark help/'
      elif [[ "${_count}" == 2 ]]
      then
        printf "%s\\n" "${__line}" \
          | sed -e 's/-----------//'
      else
        printf "%s\\n" "${__line}"
      fi
    done < <("${_NOTES_PATH:-}" bookmark)
  elif [[ "${1:-}" =~ ^-h$|^--help$|^h$|^help$ ]] ||
     {
       [[ "${1:-}" =~ ^q$|^search$ ]] && [[ -z "${2:-}" ]]
     }
  then
    cat <<HEREDOC
    __                __                        __
   / /_  ____  ____  / /______ ___  ____ ______/ /__
  / __ \\/ __ \\/ __ \\/ //_/ __ \`__ \\/ __ \`/ ___/ //_/
 / /_/ / /_/ / /_/ / ,< / / / / / / /_/ / /  / ,<
/_.___/\\____/\\____/_/|_/_/ /_/ /_/\\__,_/_/  /_/|_|

bookmark -- Command line bookmarking.

HEREDOC
    "${_NOTES_PATH:-}" help bookmark        \
      | sed -e "s/  notes /  /"             \
      | sed -e "s/Shortcut Alias: \`b\`//"  \
      | sed -e '$ d'

    cat <<HEREDOC
------------------------------------------------
Part of \`notes\` (https://github.com/xwmx/notes).
For more information, see: \`notes help\`.
HEREDOC
  else
    "${_NOTES_PATH}" bookmark "${@:-}"
  fi
} && _main "${@:-}"
